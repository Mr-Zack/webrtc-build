name: Build WebRTC on Windows

# 只允许手动触发
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    env:
      DEPOT_TOOLS_PATH: ${{ github.workspace }}\depot_tools
      DEPOT_TOOLS_WIN_TOOLCHAIN: 0  # 使用系统 MSVC 工具链

    steps:
      # 1. 检出仓库
      - name: Checkout
        uses: actions/checkout@v3

      # 2. 安装依赖（Python, Git, 7zip）
      - name: Install dependencies
        run: |
          choco install -y python3 git 7zip
          python --version
          git --version

      # 3. 克隆 depot_tools（缓存）
      - name: Cache depot_tools
        uses: actions/cache@v3
        with:
          path: depot_tools
          key: depot_tools-v1

      - name: Clone depot_tools
        if: steps.cache-depot-tools.outputs.cache-hit != 'true'
        run: |
          git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git "%DEPOT_TOOLS_PATH%"

      # 4. 设置 depot_tools 到 PATH
      - name: Add depot_tools to PATH
        run: echo "%DEPOT_TOOLS_PATH%" >>
